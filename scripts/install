#!/bin/bash

# DelGuard é€šç”¨å®‰è£…è„šæœ¬æ£€æµ‹å™¨
# è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿå¹¶è¿è¡Œç›¸åº”çš„å®‰è£…è„šæœ¬

set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
detect_os() {
    case "$(uname -s)" in
        Linux*)     OS="linux";;
        Darwin*)    OS="darwin";;
        CYGWIN*|MINGW*|MSYS*) OS="windows";;
        *)          
            log_error "ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: $(uname -s)"
            exit 1
            ;;
    esac
}

# ä¸»å‡½æ•°
main() {
    echo "ğŸ—‘ï¸  DelGuard é€šç”¨å®‰è£…è„šæœ¬"
    echo "=========================="
    
    detect_os
    log_info "æ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿ: $OS"
    
    # è·å–è„šæœ¬ç›®å½•
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    
    case "$OS" in
        "linux"|"darwin")
            INSTALL_SCRIPT="$SCRIPT_DIR/install.sh"
            if [ -f "$INSTALL_SCRIPT" ]; then
                log_info "è¿è¡Œ Unix/Linux å®‰è£…è„šæœ¬..."
                exec bash "$INSTALL_SCRIPT" "$@"
            else
                log_error "æœªæ‰¾åˆ°å®‰è£…è„šæœ¬: $INSTALL_SCRIPT"
                exit 1
            fi
            ;;
        "windows")
            log_info "æ£€æµ‹åˆ° Windows ç³»ç»Ÿ"
            log_info "è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… DelGuard:"
            echo ""
            echo "PowerShell:"
            echo "  powershell -ExecutionPolicy Bypass -File \"$SCRIPT_DIR/install.ps1\""
            echo ""
            echo "æˆ–è€…ä½¿ç”¨ curl ç›´æ¥å®‰è£…:"
            echo "  curl -fsSL https://raw.githubusercontent.com/01luyicheng/DelGuard/main/scripts/install.ps1 | powershell -"
            ;;
        *)
            log_error "ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: $OS"
            exit 1
            ;;
    esac
}

main "$@"
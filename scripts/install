#!/bin/bash

# DelGuard 通用安装脚本检测器
# 自动检测操作系统并运行相应的安装脚本

set -e

# 颜色定义
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# 检测操作系统
detect_os() {
    case "$(uname -s)" in
        Linux*)     OS="linux";;
        Darwin*)    OS="darwin";;
        CYGWIN*|MINGW*|MSYS*) OS="windows";;
        *)          
            log_error "不支持的操作系统: $(uname -s)"
            exit 1
            ;;
    esac
}

# 主函数
main() {
    echo "🗑️  DelGuard 通用安装脚本"
    echo "=========================="
    
    detect_os
    log_info "检测到操作系统: $OS"
    
    # 获取脚本目录
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    
    case "$OS" in
        "linux"|"darwin")
            INSTALL_SCRIPT="$SCRIPT_DIR/install.sh"
            if [ -f "$INSTALL_SCRIPT" ]; then
                log_info "运行 Unix/Linux 安装脚本..."
                exec bash "$INSTALL_SCRIPT" "$@"
            else
                log_error "未找到安装脚本: $INSTALL_SCRIPT"
                exit 1
            fi
            ;;
        "windows")
            log_info "检测到 Windows 系统"
            log_info "请运行以下命令安装 DelGuard:"
            echo ""
            echo "PowerShell:"
            echo "  powershell -ExecutionPolicy Bypass -File \"$SCRIPT_DIR/install.ps1\""
            echo ""
            echo "或者使用 curl 直接安装:"
            echo "  curl -fsSL https://raw.githubusercontent.com/01luyicheng/DelGuard/main/scripts/install.ps1 | powershell -"
            ;;
        *)
            log_error "不支持的操作系统: $OS"
            exit 1
            ;;
    esac
}

main "$@"
# DelGuard 安全说明

## 概述

DelGuard 提供基本的安全保护功能，帮助防止意外删除重要文件。本文档详细说明所有安全功能和使用方法。

## 核心安全功能

### 1. 路径验证与防护

#### 路径遍历攻击防护
- **路径规范化**：自动处理路径中的 `..` 和 `.` 元素
- **系统路径保护**：防止删除系统关键路径
- **路径长度限制**：最大路径长度限制为 4096 字符
- **空字节注入防护**：检测并阻止包含空字节的路径

#### 系统路径保护
```go
// 受保护的关键路径示例
C:\Windows\System32
C:\Program Files
/etc/passwd
/usr/bin
/ (根目录)
```

### 2. 文件完整性检查

#### 基本验证机制
- **文件大小检查**：限制恢复文件大小以防止资源耗尽
- **特殊文件类型过滤**：识别符号链接、设备文件、套接字等
- **扩展名检查**：可配置允许的文件类型列表

### 3. 权限管理

#### Windows平台特性
- **UAC权限提示**：需要时提示用户提升权限
- **文件权限验证**：确保对目标文件具有适当的访问权限

#### 权限检查API
```go
// 检查当前权限状态
isAdmin := IsElevated()

// 确保写权限
err := EnsureWriteAccess(filePath)
```

### 4. 配置安全

#### 配置参数验证
- **数值范围检查**：确保配置值在合理范围内
- **枚举值验证**：验证语言、模式等枚举配置
- **路径有效性检查**：验证配置中的路径是否存在且可访问

#### 安全配置示例
```json
{
  "maxBackupFiles": 10,
  "trashMaxSize": 1000,
  "language": "en",
  "safeMode": "strict",
  "logLevel": "info"
}
```

### 5. 恢复过程安全

#### 恢复选项
```go
type EnhancedRestoreOptions struct {
    SkipIntegrityCheck bool     // 跳过完整性检查
    BackupExisting     bool     // 备份已存在文件
    MaxFileSize        int64    // 最大文件大小限制
    AllowedExtensions  []string // 允许的文件扩展名
    ScanForMalware     bool     // 扫描恶意软件（需要额外配置）
}
```

#### 恢复安全流程
1. **路径验证**：检查目标路径是否安全
2. **权限检查**：验证用户是否有权限恢复
3. **文件检查**：检查文件完整性和基本安全性
4. **备份机制**：可选备份已存在的同名文件

### 6. 国际化错误处理

#### 多语言安全提示
- **中文**：完整的中文错误提示和安全建议
- **英文**：标准的英文安全信息

## 安全限制

需要注意的是，DelGuard 并不是防病毒软件或高级安全工具，它主要提供以下基本保护：

1. 防止意外删除重要文件
2. 基本的路径遍历攻击防护
3. 系统关键目录保护
4. 基本的权限检查

对于高级安全需求，建议配合专业的安全软件使用。

## 最佳实践

1. 定期检查回收站内容
2. 不要完全依赖回收站作为数据保护机制
3. 对于敏感数据，使用专业的数据销毁工具
4. 定期备份重要数据